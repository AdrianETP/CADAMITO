<div class="flex min-h-full bg-white">
  <app-sidebar-taskmanager class="min-h-full"></app-sidebar-taskmanager>

  <div class="flex-grow pl-6">
    
    <!-- Breadcrumbs -->
    <div class="text-sm breadcrumbs text-gray-700 py-8">
      <ul>
        <li><a>Roles</a></li>
      </ul>
    </div>
    <h1 class="text-2xl text-black font-medium mb-6">Asignar roles</h1>
    <div class="relative overflow-x-auto sm:rounded-lg bg-white pr-14">
      <div class="flex flex-column sm:flex-row flex-wrap space-y-4 sm:space-y-0 items-center justify-between pb-4">
        <div>
          <h3 class="font-normal text-black">Usuarios</h3>
        </div>
        <div class="w-2/3">
          <label for="table-search" class="sr-only">Search</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 rtl:inset-r-0 rtl:right-0 flex items-center ps-3 pointer-events-none">
              <svg class="w-5 h-5 text-gray-500" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                  d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                  clip-rule="evenodd"></path>
              </svg>
            </div>
            <input type="text" id="table-search" [(ngModel)]="searchText"
              class="block p-2 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg w-full bg-zinc-200"
              placeholder="Buscar por nombre">
          </div>
        </div>
      </div>
      <table id="data-table" class="w-full text-sm text-left rtl:text-right text-gray-500">
        <thead class="text-sm text-gray-700 bg-zinc-200">
          <tr>
            <th scope="col" class="py-3 pl-1 w-1/4 relative ">
              <button (click)="toggleDropdown('nombre')"
                class="w-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium text-gray-900 bg-zinc-200 rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700">
                Nombre
                <svg class="-ml-1 mr-1.5 w-5 h-5 pl-1" fill="currentColor" viewbox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path clip-rule="evenodd" fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                </svg>
              </button>
              <div *ngIf="showNombreDropdown"
                class="absolute z-10 w-44 bg-zinc-200 rounded divide-y divide-gray-100 shadow">
                <ul class="py-1 text-sm text-gray-900 font-normal divide-y divide-gray-100">
                  <li (click)="sortBy('usuarioNombre', 'asc', $event)">
                    <a href="#" class="block py-2 px-4 text-sm text-gray-900 hover:bg-gray-100">Ascendente</a>
                  </li>
                  <li (click)="sortBy('usuarioNombre', 'desc', $event)">
                    <a href="#" class="block py-2 px-4 text-sm text-gray-900 hover:bg-gray-100">Descendente</a>
                  </li>
                </ul>
              </div>
            </th>
            <th scope="col" class="px-6 py-3 w-1/5">
              Correo
            </th>
            <th scope="col" class="py-3 w-1/4 relative dropdown-container">

              <button (click)="toggleDropdown('departamento')"
                class="w-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium text-gray-900 bg-zinc-200 rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700">
                Departamento
                <svg class="-ml-1 mr-1.5 w-5 h-5 pl-1" fill="currentColor" viewbox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path clip-rule="evenodd" fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                </svg>
              </button>
              <div *ngIf="showDepartamentoDropdown" class="dropdown-content">
                <ul class="divide-y divide-gray-100">
                  <li *ngFor="let dept of departamentos" class="flex items-center px-4 py-2">
                    <input type="checkbox" [id]="dept.nombre" [checked]="selectedDepartamentos.includes(dept.nombre)" (change)="onDepartamentoChange(dept.nombre, $event)" class="mr-2">
                    <label [for]="dept.nombre" class="text-sm text-gray-900 cursor-pointer font-normal">{{ dept.nombre }}</label>
                  </li>
                </ul>
              </div>
            </th>            
            <th scope="col" class="py-3 w-1/4 relative">
              <button (click)="toggleDropdown('rol')"
                class="w-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium text-gray-900 bg-zinc-200 rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700">
                Rol
                <svg class="-ml-1 mr-1.5 w-5 h-5 pl-1" fill="currentColor" viewbox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path clip-rule="evenodd" fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                </svg>
              </button>
              <div *ngIf="showRolDropdown"
                class="dropdown-content">
                <ul class="divide-y divide-gray-100">
                  <li class="flex items-center px-4 py-2">
                    <input type="checkbox" id="miembro" [checked]="selectedRoles.includes('Miembro')" (change)="onRolChange('Miembro', $event)" class="mr-2">
                    <label for="miembro" class="text-sm text-gray-900 cursor-pointer font-normal">Miembro</label>
                  </li>
                  <li class="flex items-center px-4 py-2">
                    <input type="checkbox" id="administrador" [checked]="selectedRoles.includes('Administrador')" (change)="onRolChange('Administrador', $event)" class="mr-2">
                    <label for="administrador" class="text-sm text-gray-900 cursor-pointer font-normal">Administrador</label>
                  </li>
                </ul>
              </div>
            </th>
            <th scope="col" class="px-6 py-3 w-1/5 text-center">
              Acción
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let usuario of filterUsuarios()" class="bg-neutral-100 border-b hover:bg-neutral-200">
            <td class="px-6 py-4">{{ usuario.usuarioNombre }}</td>
            <td class="px-6 py-4">{{ usuario.usuarioCorreo }}</td>
            <td class="px-6 py-4">
              <ng-container *ngIf="!usuario.isEditing">{{ usuario.usuarioDepartamento }}</ng-container>
              <ng-container *ngIf="usuario.isEditing">
                <select [(ngModel)]="usuario.usuarioDepartamento" class="bg-zinc-200 text-gray-500 rounded">
                  <option *ngFor="let dept of departamentos" [value]="dept.nombre">{{ dept.nombre }}</option>
                </select>
              </ng-container>
            </td>            
            <td class="px-6 py-4">
              <ng-container *ngIf="!usuario.isEditing">{{ usuario.usuarioRol }}</ng-container>
              <ng-container *ngIf="usuario.isEditing">
                <select [(ngModel)]="usuario.usuarioRol" class="bg-zinc-200 text-gray-500 rounded">
                  <option *ngFor="let rol of rolesList" [value]="rol">{{ rol }}</option>
                </select>
              </ng-container>
            </td>
            <td class="px-6 py-4 text-center flex justify-center items-center space-x-2">
              <button *ngIf="!usuario.isEditing" (click)="toggleEdit(usuario)" class="text-gray-500 hover:text-gray-700"
                aria-label="Editar Rol">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 512 512">
                  <path
                    d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z" />
                </svg>
              </button>
              <button *ngIf="usuario.isEditing" (click)="saveChanges(usuario)"
                class="bg-green-500 hover:bg-green-700 text-white font-bold p-1 rounded-full inline-flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-4 h-4" viewBox="0 0 512 512">
                  <path
                    d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z" />
                </svg>
              </button>
              <button *ngIf="usuario.isEditing" (click)="cancelEdit(usuario)"
                class="bg-red-500 hover:bg-red-700 text-white font-bold p-1 rounded-full inline-flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-4 h-4" viewBox="0 0 512 512">
                  <path
                    d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z" />
                </svg>
              </button>
              <button (click)="openModal(usuario)" class="text-gray-500 hover:text-red-500"
                aria-label="Eliminar usuario">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 448 512">
                  <path
                    d="M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z" />
                </svg>
              </button>
              <div tabindex="-1" [class.hidden]="!isModalOpen" [class.modal-backdrop]="isModalOpen"
                class="overflow-y-auto overflow-x-hidden fixed top-0 right-0 z-40 items-center w-full h-screen" style="background-color: rgba(200, 200, 200, 0.07);">
                <div class="relative p-4 w-full max-w-md h-auto">
                  <div class="relative bg-white rounded-lg">
                    <button type="button" (click)="closeModal()"
                      class="absolute top-3 end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center">
                      <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 14 14">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                      </svg>
                      <span class="sr-only">Close modal</span>
                    </button>
                    <div class="p-4 md:p-5 text-center">
                      <svg class="mx-auto mb-4 text-gray-400 w-12 h-12" aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                      </svg>
                      <h3 class="mb-5 text-lg font-normal text-gray-500">
                        ¿Seguro que deseas eliminar este usuario?</h3>
                      <button type="button" (click)="selectedUsuario ? deleteUsuario(selectedUsuario) : null"
                        class="text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center">
                        Eliminar
                      </button>
                      <button (click)="closeModal()" type="button"
                        class="py-2.5 px-5 ms-3 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100">
                        Cancelar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
        <tfoot class="bg-zinc-200">
          <tr>
            <td colspan="5" class="py-3 text-center text-gray-700">
              Total de usuarios: {{ filterUsuarios().length }}
            </td>
          </tr>
        </tfoot>
      </table>
      <div class="mt-6 bg-white h-12"></div> 
    </div>
  </div>
</div>
